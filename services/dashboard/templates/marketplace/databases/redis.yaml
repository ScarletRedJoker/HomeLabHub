metadata:
  id: redis
  name: Redis
  category: database
  description: "In-memory data structure store - cache and message broker"
  icon: "ðŸ”´"
  version: "7-alpine"
  author: "Redis Ltd."
  tags: ["cache", "database", "nosql", "key-value"]
  
docker:
  image: "redis:7-alpine"
  container_name: "{{ DB_NAME }}"
  restart: always
  
  environment:
    REDIS_PASSWORD: "{{ REDIS_PASS }}"
  
  volumes:
    - "{{ DATA_DIR }}/data:/data"
    - "{{ DATA_DIR }}/redis.conf:/usr/local/etc/redis/redis.conf"
  
  networks:
    - "{{ NETWORK }}"
  
  ports:
    - "{{ PORT }}:6379"
  
  command: "redis-server --requirepass {{ REDIS_PASS }} --appendonly yes"

requirements:
  database: none
  storage: "2GB"
  memory: "256MB"
  cpu: "1"

configuration:
  variables:
    - name: DB_NAME
      label: "Container Name"
      type: string
      default: "redis"
      required: true
      validation: "^[a-z0-9-]+$"
    
    - name: REDIS_PASS
      label: "Redis Password"
      type: password
      required: true
      generate: true
    
    - name: PORT
      label: "Port"
      type: number
      default: 6379
      required: true
    
    - name: DATA_DIR
      label: "Data Directory"
      type: string
      default: "/var/lib/redis"
      required: true
    
    - name: NETWORK
      label: "Docker Network"
      type: string
      default: "homelab"
      required: true
    
    - name: MAX_MEMORY
      label: "Max Memory (e.g., 256mb)"
      type: string
      default: "256mb"
      required: false

setup:
  steps:
    - name: "Create data directory"
      action: create_directories
      params:
        paths:
          - "{{ DATA_DIR }}/data"
    
    - name: "Wait for Redis to be ready"
      action: wait_for_healthy
      container: "{{ DB_NAME }}"
      timeout: 30

health_check:
  endpoint: "redis://localhost:{{ PORT }}"
  interval: 30s
  timeout: 5s
  retries: 3

documentation:
  readme: |
    # Redis Cache
    
    Connection details:
    - Host: localhost
    - Port: {{ PORT }}
    - Password: {{ REDIS_PASS }}
    
    ## Connection String:
    redis://:{{ REDIS_PASS }}@localhost:{{ PORT }}/0
    
    ## Management:
    - Use redis-cli: `docker exec -it {{ DB_NAME }} redis-cli -a {{ REDIS_PASS }}`
    - RedisInsight recommended for GUI management
    
    ## Common Commands:
    - PING - Test connection
    - SET key value - Set a key
    - GET key - Get a key
    - KEYS * - List all keys
    - INFO - Server info
    
    ## Use Cases:
    - Session storage
    - Cache layer
    - Message queue
    - Real-time analytics
  
  links:
    - name: "Redis Documentation"
      url: "https://redis.io/docs/"
    - name: "Redis Commands"
      url: "https://redis.io/commands/"
    - name: "RedisInsight"
      url: "https://redis.com/redis-enterprise/redis-insight/"
